<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NuConnect Sales Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f9fafb; }
        .container { max-width: 1280px; margin: 0 auto; padding: 24px; }
        .header { margin-bottom: 24px; }
        .header h1 { font-size: 30px; font-weight: 700; color: #111827; margin-bottom: 4px; }
        .header p { color: #6b7280; font-size: 14px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .kpi-card { background: white; border-radius: 8px; padding: 20px; border: 1px solid #e5e7eb; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .kpi-title { font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .kpi-value { font-size: 28px; font-weight: 700; color: #111827; margin-bottom: 4px; }
        .kpi-subtitle { font-size: 13px; color: #9ca3af; margin-bottom: 8px; }
        .progress-bar { width: 100%; height: 6px; background: #e5e7eb; border-radius: 999px; overflow: hidden; margin-top: 12px; }
        .progress-fill { height: 100%; transition: width 0.3s; }
        .progress-blue { background: #3b82f6; }
        .progress-green { background: #10b981; }
        .progress-orange { background: #f59e0b; }
        .table-container { background: white; border-radius: 8px; padding: 20px; border: 1px solid #e5e7eb; margin-bottom: 24px; }
        .table-title { font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 16px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px 16px; font-size: 13px; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; }
        td { padding: 12px 16px; font-size: 14px; color: #6b7280; border-bottom: 1px solid #f3f4f6; }
        tr:hover { background: #f9fafb; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .badge-starter { background: #dbeafe; color: #1e40af; }
        .badge-growth { background: #d1fae5; color: #065f46; }
        .badge-pro { background: #fef3c7; color: #92400e; }
        .badge-enterprise { background: #e9d5ff; color: #6b21a8; }
        .deals-grid { display: grid; gap: 12px; }
        .deal-card { background: #f9fafb; border-radius: 8px; padding: 16px; display: flex; justify-content: space-between; align-items: center; }
        .deal-card:hover { background: #f3f4f6; }
        .deal-company { font-weight: 500; color: #111827; margin-bottom: 4px; }
        .deal-meta { font-size: 13px; color: #6b7280; display: flex; align-items: center; gap: 8px; }
        .deal-value { font-size: 18px; font-weight: 700; color: #111827; text-align: right; }
        .deal-date { font-size: 12px; color: #9ca3af; text-align: right; }
        .btn { padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; border: none; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-secondary { background: white; border: 1px solid #d1d5db; color: #374151; }
        .btn-secondary:hover { background: #f9fafb; }
        .setup-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; border-radius: 12px; padding: 32px; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-title { font-size: 24px; font-weight: 700; color: #111827; }
        .close-btn { font-size: 24px; color: #9ca3af; cursor: pointer; background: none; border: none; }
        .close-btn:hover { color: #6b7280; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 4px; }
        .form-input { width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        .form-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        .form-hint { font-size: 12px; color: #6b7280; margin-top: 4px; }
        .btn-group { display: flex; gap: 12px; margin-top: 24px; }
        .banner { background: #fef3c7; border: 1px solid #fde68a; border-radius: 6px; padding: 12px 16px; margin-bottom: 16px; }
        .banner-text { font-size: 14px; font-weight: 500; color: #92400e; }
        .quota-section { text-align: right; margin-top: 16px; }
        .quota-label { font-size: 13px; color: #6b7280; }
        .quota-value { font-size: 32px; font-weight: 700; color: #111827; margin: 4px 0; }
        .quota-percent { font-size: 14px; font-weight: 600; }
        .quota-good { color: #059669; }
        .quota-warning { color: #d97706; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // State management
        let state = {
            showConfig: false,
            baseId: localStorage.getItem('airtable_baseId') || '',
            apiKey: localStorage.getItem('airtable_apiKey') || '',
            configured: !!(localStorage.getItem('airtable_baseId') && localStorage.getItem('airtable_apiKey'))
        };

        // Mock data
        const data = {
            repName: "Sarah Johnson",
            repQuota: 45000,
            currentRevenue: 38500,
            goals: {
                revenue: { current: 38500, target: 45000 },
                events: { current: 18, target: 22 },
                floorPriceUsed: { current: 2, target: 3 },
                avgDealSize: { current: 2139, target: 2045 }
            },
            dealsByTier: [
                { tier: 'Starter', closed: 6, revenue: 3000, pipeline: 4 },
                { tier: 'Growth', closed: 8, revenue: 10000, pipeline: 7 },
                { tier: 'Pro', closed: 3, revenue: 6000, pipeline: 5 },
                { tier: 'Enterprise', closed: 1, revenue: 19500, pipeline: 3 }
            ],
            recentDeals: [
                { company: 'Tech Summit Inc', tier: 'Enterprise', value: 19500, date: '2 days ago', closeTime: 32 },
                { company: 'Local Biz Expo', tier: 'Growth', value: 1250, date: '4 days ago', closeTime: 18 },
                { company: 'Startup Connect', tier: 'Pro', value: 2000, date: '1 week ago', closeTime: 28 },
                { company: 'Community Fest', tier: 'Starter', value: 750, date: '1 week ago', closeTime: 12 }
            ]
        };

        function getTierClass(tier) {
            return tier === 'Enterprise' ? 'badge-enterprise' :
                   tier === 'Pro' ? 'badge-pro' :
                   tier === 'Growth' ? 'badge-growth' : 'badge-starter';
        }

        function render() {
            const app = document.getElementById('app');
            const quotaAttainment = (data.currentRevenue / data.repQuota) * 100;
            const quotaClass = quotaAttainment >= 100 ? 'quota-good' : 'quota-warning';

            if (state.showConfig) {
                app.innerHTML = `
                    <div class="setup-modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2 class="modal-title">Airtable Setup</h2>
                                <button class="close-btn" onclick="closeModal()">‚úï</button>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Airtable Base ID</label>
                                <input type="text" class="form-input" id="baseId" placeholder="app0WnWepz3soa88I" value="${state.baseId}">
                                <div class="form-hint">Find this in your Airtable URL</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">API Key (Personal Access Token)</label>
                                <input type="password" class="form-input" id="apiKey" placeholder="patXXXXXXXX..." value="${state.apiKey}">
                                <div class="form-hint">Create at airtable.com/create/tokens</div>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-primary" style="flex: 1" onclick="saveConfig()">Connect</button>
                                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                app.innerHTML = `
                    <div class="container">
                        <div class="header">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h1>${state.configured ? data.repName : 'Demo'}'s Dashboard</h1>
                                    <p>Track your performance and hit your goals</p>
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    ${!state.configured ? '<div class="banner"><span class="banner-text">Using demo data</span></div>' : ''}
                                    <button class="btn btn-secondary" onclick="openModal()">‚öôÔ∏è Setup</button>
                                </div>
                            </div>
                            <div class="quota-section">
                                <div class="quota-label">Monthly Quota</div>
                                <div class="quota-value">$${(data.repQuota / 1000).toFixed(0)}K</div>
                                <div class="quota-percent ${quotaClass}">${quotaAttainment.toFixed(1)}% Attainment</div>
                            </div>
                        </div>

                        <div class="kpi-grid">
                            <div class="kpi-card">
                                <div class="kpi-title">Revenue</div>
                                <div class="kpi-value">$${(data.goals.revenue.current / 1000).toFixed(1)}K</div>
                                <div class="kpi-subtitle">Goal: $${(data.goals.revenue.target / 1000).toFixed(0)}K</div>
                                <div class="progress-bar">
                                    <div class="progress-fill progress-blue" style="width: ${(data.goals.revenue.current / data.goals.revenue.target) * 100}%"></div>
                                </div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-title">Events Closed</div>
                                <div class="kpi-value">${data.goals.events.current}</div>
                                <div class="kpi-subtitle">Goal: ${data.goals.events.target}</div>
                                <div class="progress-bar">
                                    <div class="progress-fill progress-green" style="width: ${(data.goals.events.current / data.goals.events.target) * 100}%"></div>
                                </div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-title">Avg Deal Size</div>
                                <div class="kpi-value">$${data.goals.avgDealSize.current.toLocaleString()}</div>
                                <div class="kpi-subtitle">Target: $${data.goals.avgDealSize.target.toLocaleString()}</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-title">Floor Price Used</div>
                                <div class="kpi-value">${data.goals.floorPriceUsed.current}/${data.goals.floorPriceUsed.target}</div>
                                <div class="kpi-subtitle">Remaining: ${data.goals.floorPriceUsed.target - data.goals.floorPriceUsed.current}</div>
                            </div>
                        </div>

                        <div class="table-container">
                            <h3 class="table-title">Performance by Tier</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tier</th>
                                        <th>Closed Deals</th>
                                        <th>Revenue</th>
                                        <th>Pipeline</th>
                                        <th>Avg Deal Size</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.dealsByTier.map(tier => `
                                        <tr>
                                            <td><span class="badge ${getTierClass(tier.tier)}">${tier.tier}</span></td>
                                            <td>${tier.closed}</td>
                                            <td>$${tier.revenue.toLocaleString()}</td>
                                            <td>${tier.pipeline} deals</td>
                                            <td>$${(tier.revenue / tier.closed).toFixed(0)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div class="table-container">
                            <h3 class="table-title">Recent Wins üéâ</h3>
                            <div class="deals-grid">
                                ${data.recentDeals.map(deal => `
                                    <div class="deal-card">
                                        <div>
                                            <div class="deal-company">${deal.company}</div>
                                            <div class="deal-meta">
                                                <span class="badge ${getTierClass(deal.tier)}">${deal.tier}</span>
                                                <span>‚Ä¢</span>
                                                <span>${deal.closeTime} days</span>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="deal-value">$${deal.value.toLocaleString()}</div>
                                            <div class="deal-date">${deal.date}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function openModal() {
            state.showConfig = true;
            render();
        }

        function closeModal() {
            state.showConfig = false;
            render();
        }

        function saveConfig() {
            const baseId = document.getElementById('baseId').value;
            const apiKey = document.getElementById('apiKey').value;
            
            if (baseId && apiKey) {
                localStorage.setItem('airtable_baseId', baseId);
                localStorage.setItem('airtable_apiKey', apiKey);
                state.baseId = baseId;
                state.apiKey = apiKey;
                state.configured = true;
                state.showConfig = false;
                render();
            }
        }

        // Initial render
        render();
    </script>
</body>
</html>
