<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NuConnect CRM</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --gray-900: #1e293b;
            --gray-800: #334155;
            --gray-700: #475569;
            --gray-600: #64748b;
            --gray-500: #94a3b8;
            --gray-400: #cbd5e1;
            --gray-300: #e2e8f0;
            --gray-200: #f1f5f9;
            --gray-100: #f8fafc;
            --white: #ffffff;
            --starter: #3b82f6;
            --growth: #10b981;
            --pro: #f59e0b;
            --enterprise: #8b5cf6;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --gradient-accent: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 25px -3px rgb(0 0 0 / 0.15);
            --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-100);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .hidden { display: none !important; }

        /* ==================== LOGIN SCREEN ==================== */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .login-screen::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            animation: pulse-bg 8s ease-in-out infinite;
        }

        @keyframes pulse-bg {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .login-card {
            background: var(--white);
            padding: 48px 40px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            max-width: 420px;
            width: 100%;
            position: relative;
            z-index: 1;
            animation: slide-up 0.6s ease-out;
        }

        @keyframes slide-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            text-align: center;
            color: var(--gray-600);
            margin-bottom: 40px;
            font-size: 15px;
        }

        .input-group {
            margin-bottom: 24px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-800);
            font-size: 14px;
        }

        .input-field {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: var(--white);
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-icon {
            padding: 10px;
            border-radius: var(--radius);
            background: var(--gray-200);
        }

        .login-error {
            background: #fef2f2;
            color: var(--danger);
            padding: 12px 16px;
            border-radius: var(--radius);
            font-size: 14px;
            margin-bottom: 20px;
            border: 1px solid #fecaca;
        }

        /* ==================== MAIN APP ==================== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--dark);
            color: var(--white);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 28px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-user {
            padding: 20px 24px;
            background: rgba(255,255,255,0.05);
            margin: 16px;
            border-radius: var(--radius);
        }

        .sidebar-user-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .sidebar-user-role {
            font-size: 13px;
            color: var(--gray-500);
        }

        .sidebar-nav {
            flex: 1;
            padding: 8px 16px;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            border-radius: var(--radius);
            color: var(--gray-400);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.05);
            color: var(--white);
        }

        .nav-item.active {
            background: var(--primary);
            color: var(--white);
        }

        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 16px 24px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .logout-btn {
            width: 100%;
            padding: 12px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius);
            color: #fca5a5;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 32px;
            min-height: 100vh;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .page-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: var(--dark);
        }

        .page-subtitle {
            color: var(--gray-600);
            font-size: 15px;
            margin-top: 4px;
        }

        /* View Toggle */
        .view-toggle {
            display: flex;
            gap: 8px;
            background: var(--white);
            padding: 6px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
        }

        .toggle-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--gray-600);
        }

        .toggle-btn.active {
            background: var(--primary);
            color: var(--white);
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .kpi-card.gradient {
            color: var(--white);
        }

        .kpi-card.gradient-purple {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }

        .kpi-card.gradient-pink {
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
        }

        .kpi-card.gradient-cyan {
            background: linear-gradient(135deg, #06b6d4 0%, #0ea5e9 100%);
        }

        .kpi-card.gradient-amber {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
        }

        .kpi-card.gradient-emerald {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .kpi-label {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 12px;
        }

        .kpi-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .kpi-target {
            font-size: 13px;
            opacity: 0.8;
        }

        .kpi-progress {
            height: 6px;
            background: rgba(255,255,255,0.25);
            border-radius: 3px;
            margin-top: 16px;
            overflow: hidden;
        }

        .kpi-progress-bar {
            height: 100%;
            background: var(--white);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Daily Scorecard */
        .scorecard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .scorecard-item {
            padding: 20px;
            background: var(--gray-100);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .scorecard-item.success {
            border-left-color: var(--success);
            background: #ecfdf5;
        }

        .scorecard-item.warning {
            border-left-color: var(--warning);
            background: #fffbeb;
        }

        .scorecard-item.danger {
            border-left-color: var(--danger);
            background: #fef2f2;
        }

        .scorecard-label {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .scorecard-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: var(--dark);
        }

        .scorecard-target {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 6px;
        }

        /* Deal Mix Table */
        .deal-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .deal-table th {
            text-align: left;
            padding: 14px 16px;
            background: var(--gray-100);
            font-weight: 600;
            font-size: 13px;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .deal-table th:first-child {
            border-radius: var(--radius) 0 0 var(--radius);
        }

        .deal-table th:last-child {
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        .deal-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            font-size: 14px;
        }

        .deal-table tr:last-child td {
            border-bottom: none;
        }

        /* Tier Badges */
        .tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .tier-badge.starter {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .tier-badge.growth {
            background: #d1fae5;
            color: #047857;
        }

        .tier-badge.pro {
            background: #fef3c7;
            color: #b45309;
        }

        .tier-badge.enterprise {
            background: #ede9fe;
            color: #6d28d9;
        }

        /* Quality Badge */
        .quality-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
        }

        .quality-badge.success {
            background: #d1fae5;
            color: #047857;
        }

        .quality-badge.warning {
            background: #fef3c7;
            color: #b45309;
        }

        .quality-badge.danger {
            background: #fee2e2;
            color: #b91c1c;
        }

        /* Recent Wins */
        .wins-list {
            list-style: none;
        }

        .win-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: var(--gray-100);
            border-radius: var(--radius);
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .win-item:hover {
            background: var(--gray-200);
            transform: translateX(4px);
        }

        .win-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .win-details h4 {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .win-meta {
            font-size: 13px;
            color: var(--gray-600);
        }

        .win-amount {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--success);
        }

        /* Floor Pricing Tracker */
        .floor-tracker {
            text-align: center;
            padding: 32px;
        }

        .capacity-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 24px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--white);
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.4);
            position: relative;
        }

        .capacity-circle::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            background: var(--gradient-primary);
            opacity: 0.3;
            animation: pulse-ring 2s ease-out infinite;
        }

        @keyframes pulse-ring {
            0% { transform: scale(1); opacity: 0.3; }
            100% { transform: scale(1.15); opacity: 0; }
        }

        .capacity-number {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 56px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .capacity-label {
            font-size: 14px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .capacity-percentage {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .capacity-remaining {
            color: var(--gray-600);
            margin-bottom: 24px;
        }

        .capacity-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .capacity-table th {
            text-align: left;
            padding: 14px 16px;
            background: var(--gray-100);
            font-weight: 600;
            font-size: 13px;
            color: var(--gray-700);
        }

        .capacity-table th:first-child { border-radius: var(--radius) 0 0 var(--radius); }
        .capacity-table th:last-child { border-radius: 0 var(--radius) var(--radius) 0; }

        .capacity-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .remaining-cell {
            font-weight: 700;
        }

        .remaining-cell.low {
            color: var(--warning);
        }

        .remaining-cell.zero {
            color: var(--danger);
        }

        /* Rep Cards */
        .rep-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .rep-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .rep-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .rep-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .rep-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 20px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .rep-name {
            font-weight: 700;
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .rep-role {
            font-size: 13px;
            color: var(--gray-600);
        }

        .rep-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .rep-metric {
            text-align: center;
            padding: 12px;
            background: var(--gray-100);
            border-radius: var(--radius);
        }

        .rep-metric-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .rep-metric-label {
            font-size: 12px;
            color: var(--gray-600);
            margin-top: 4px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--radius-xl);
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modal-in 0.3s ease-out;
        }

        @keyframes modal-in {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            border-bottom: 1px solid var(--gray-200);
        }

        .modal-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 24px;
            font-weight: 700;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--gray-200);
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--gray-300);
        }

        .modal-body {
            padding: 32px;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 48px;
            color: var(--gray-500);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 48px;
            color: var(--gray-500);
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--gray-300);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1100;
        }

        .toast {
            background: var(--dark);
            color: var(--white);
            padding: 16px 24px;
            border-radius: var(--radius);
            margin-bottom: 12px;
            box-shadow: var(--shadow-lg);
            animation: slide-in 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        @keyframes slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .scorecard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
        }

        /* Settings Panel */
        .settings-fab {
            position: fixed;
            top: 24px;
            right: 24px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--white);
            border: none;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            font-size: 20px;
            z-index: 90;
            transition: all 0.2s;
        }

        .settings-fab:hover {
            transform: scale(1.1);
        }

        .settings-panel {
            position: fixed;
            top: 80px;
            right: 24px;
            background: var(--white);
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: 95;
            width: 320px;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .settings-title {
            font-weight: 700;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <!-- ==================== LOGIN SCREEN ==================== -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <div class="login-logo">üéØ NuConnect</div>
            <p class="login-subtitle">CRM Dashboard</p>
            
            <div id="loginError" class="login-error hidden"></div>
            
            <div class="input-group">
                <label class="input-label">Select Your Name</label>
                <select id="loginUser" class="input-field">
                    <option value="">-- Select User --</option>
                    <option value="Javonte">Javonte (BDR)</option>
                    <option value="Teslim">Teslim (BDR)</option>
                    <option value="Israel">Israel (BDR)</option>
                    <option value="Conrad">Conrad (AE)</option>
                    <option value="Ramallah">Ramallah (Leadership)</option>
                    <option value="Keyna">Keyna (Leadership)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label class="input-label">Password</label>
                <input type="password" id="loginPassword" class="input-field" placeholder="Enter password">
            </div>
            
            <button class="btn btn-primary" onclick="handleLogin()">Sign In ‚Üí</button>
            
            <p style="text-align: center; margin-top: 24px; color: var(--gray-500); font-size: 13px;">
                BDRs/AE: <code>nuconnect2025</code><br>
                Leadership: <code>admin2025</code>
            </p>
        </div>
    </div>

    <!-- ==================== MAIN APP ==================== -->
    <div id="appContainer" class="app-container hidden">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üéØ NuConnect</div>
            </div>
            
            <div class="sidebar-user">
                <div class="sidebar-user-name" id="userName">-</div>
                <div class="sidebar-user-role" id="userRole">-</div>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-item active" data-view="dashboard" onclick="switchNav(this)">
                    <span class="nav-icon">üìä</span> Dashboard
                </div>
                <div class="nav-item" data-view="deals" onclick="switchNav(this)">
                    <span class="nav-icon">üíº</span> Deals
                </div>
                <div class="nav-item" data-view="activities" onclick="switchNav(this)">
                    <span class="nav-icon">‚ö°</span> Activities
                </div>
                <div class="nav-item" data-view="contacts" onclick="switchNav(this)">
                    <span class="nav-icon">üë•</span> Contacts
                </div>
            </div>
            
            <div class="sidebar-footer">
                <button class="logout-btn" onclick="handleLogout()">üö™ Sign Out</button>
            </div>
        </nav>

        <!-- Settings FAB -->
        <button class="settings-fab" onclick="toggleSettings()">‚öôÔ∏è</button>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel hidden">
            <div class="settings-header">
                <span class="settings-title">Airtable Settings</span>
                <button class="modal-close" onclick="toggleSettings()">√ó</button>
            </div>
            <div class="input-group">
                <label class="input-label">Base ID</label>
                <input type="text" id="baseIdInput" class="input-field" placeholder="appXXXXXXXXXXXXXX" value="app0WnWepz3soa88I">
            </div>
            <div class="input-group">
                <label class="input-label">API Key</label>
                <input type="password" id="apiKeyInput" class="input-field" placeholder="pat...">
            </div>
            <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                    <p class="page-subtitle" id="pageSubtitle">Track your performance</p>
                </div>
                <div class="view-toggle" id="viewToggle">
                    <button class="toggle-btn active" onclick="switchView('rep', this)">My Dashboard</button>
                    <button class="toggle-btn" onclick="switchView('leadership', this)">Leadership</button>
                </div>
            </div>

            <!-- ==================== REP DASHBOARD ==================== -->
            <div id="repDashboard">
                <!-- Daily Scorecard -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üìã Today's Scorecard</h2>
                        <span style="font-size: 13px; color: var(--gray-500);" id="todayDate"></span>
                    </div>
                    <div class="scorecard-grid">
                        <div class="scorecard-item" id="touchpointsCard">
                            <div class="scorecard-label">Touchpoints</div>
                            <div class="scorecard-value" id="touchpointsValue">0</div>
                            <div class="scorecard-target">Target: 20-25</div>
                        </div>
                        <div class="scorecard-item" id="leadsCard">
                            <div class="scorecard-label">New Leads</div>
                            <div class="scorecard-value" id="leadsValue">0</div>
                            <div class="scorecard-target">Target: 3-5</div>
                        </div>
                        <div class="scorecard-item" id="discoveryCard">
                            <div class="scorecard-label">Discovery Calls</div>
                            <div class="scorecard-value" id="discoveryValue">0</div>
                            <div class="scorecard-target">Target: 1</div>
                        </div>
                        <div class="scorecard-item" id="dealsMovedCard">
                            <div class="scorecard-label">Deals Moved</div>
                            <div class="scorecard-value" id="dealsMovedValue">0</div>
                            <div class="scorecard-target">Target: 1</div>
                        </div>
                    </div>
                </div>

                <!-- Monthly KPIs -->
                <div class="kpi-grid">
                    <div class="kpi-card gradient gradient-purple">
                        <div class="kpi-label">Monthly Revenue</div>
                        <div class="kpi-value" id="repRevenue">$0</div>
                        <div class="kpi-target">Target: $9,750 - $12,700</div>
                        <div class="kpi-progress">
                            <div class="kpi-progress-bar" id="repRevenueBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="kpi-card gradient gradient-pink">
                        <div class="kpi-label">Deals Closed</div>
                        <div class="kpi-value" id="repDeals">0</div>
                        <div class="kpi-target">Target: 6-7 deals</div>
                    </div>
                    <div class="kpi-card gradient gradient-cyan">
                        <div class="kpi-label">Quality Score</div>
                        <div class="kpi-value" id="repQuality">0%</div>
                        <div class="kpi-target">70%+ Growth or Higher</div>
                    </div>
                    <div class="kpi-card gradient gradient-amber">
                        <div class="kpi-label">Avg Deal Size</div>
                        <div class="kpi-value" id="repAvgDeal">$0</div>
                        <div class="kpi-target">Varies by tier</div>
                    </div>
                </div>

                <!-- Monthly Deal Mix -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üéØ Monthly Deal Mix</h2>
                        <div id="qualityBadge"></div>
                    </div>
                    <table class="deal-table">
                        <thead>
                            <tr>
                                <th>Tier</th>
                                <th>Target</th>
                                <th>Closed</th>
                                <th>Pipeline</th>
                                <th>Revenue</th>
                                <th>Avg Size</th>
                            </tr>
                        </thead>
                        <tbody id="dealMixBody">
                            <tr><td colspan="6" class="loading"><div class="spinner"></div> Loading...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Recent Wins -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üèÜ Recent Wins</h2>
                    </div>
                    <ul class="wins-list" id="recentWins">
                        <li class="loading"><div class="spinner"></div> Loading...</li>
                    </ul>
                </div>

                <!-- Revenue Chart -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üìà Revenue Trend</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="repRevenueChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ==================== LEADERSHIP DASHBOARD ==================== -->
            <div id="leadershipDashboard" class="hidden">
                <!-- Team KPIs -->
                <div class="kpi-grid">
                    <div class="kpi-card gradient gradient-purple">
                        <div class="kpi-label">Monthly Revenue</div>
                        <div class="kpi-value" id="teamRevenue">$0</div>
                        <div class="kpi-target">Target: $32K-$34K</div>
                        <div class="kpi-progress">
                            <div class="kpi-progress-bar" id="teamRevenueBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="kpi-card gradient gradient-pink">
                        <div class="kpi-label">Events Closed</div>
                        <div class="kpi-value" id="teamEvents">0</div>
                        <div class="kpi-target">Target: 18-21 events</div>
                    </div>
                    <div class="kpi-card gradient gradient-cyan">
                        <div class="kpi-label">Team Quality</div>
                        <div class="kpi-value" id="teamQuality">0%</div>
                        <div class="kpi-target">70%+ Growth or Higher</div>
                    </div>
                    <div class="kpi-card gradient gradient-amber">
                        <div class="kpi-label">Today's Touchpoints</div>
                        <div class="kpi-value" id="teamTouchpoints">0</div>
                        <div class="kpi-target">Target: 60-75</div>
                    </div>
                </div>

                <!-- Floor Pricing Tracker -->
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">üö® Floor-Price Event Capacity</h2>
                            <p class="card-subtitle">Maximum 8-10 events per year at floor pricing</p>
                        </div>
                    </div>
                    <div class="floor-tracker">
                        <div class="capacity-circle">
                            <div class="capacity-number" id="floorUsed">0</div>
                            <div class="capacity-label">of 10 used</div>
                        </div>
                        <div class="capacity-percentage" id="floorPercent">0% Utilized</div>
                        <div class="capacity-remaining" id="floorRemaining">Remaining: 10</div>
                        <table class="capacity-table">
                            <thead>
                                <tr>
                                    <th>Tier</th>
                                    <th>Max Floor</th>
                                    <th>Used</th>
                                    <th>Remaining</th>
                                </tr>
                            </thead>
                            <tbody id="floorCapacityBody">
                                <tr><td colspan="4" class="loading"><div class="spinner"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Annual Progress -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-label" style="color: var(--gray-600)">Annual Revenue</div>
                        <div class="kpi-value" style="color: var(--dark)" id="annualRevenue">$0</div>
                        <div class="kpi-target" style="color: var(--gray-500)">Target: $335K-$340K</div>
                        <div class="kpi-progress" style="background: var(--gray-200)">
                            <div class="kpi-progress-bar" id="annualRevenueBar" style="width: 0%; background: var(--primary)"></div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label" style="color: var(--gray-600)">Annual Events</div>
                        <div class="kpi-value" style="color: var(--dark)" id="annualEvents">0</div>
                        <div class="kpi-target" style="color: var(--gray-500)">Target: 140-200 events</div>
                        <div class="kpi-progress" style="background: var(--gray-200)">
                            <div class="kpi-progress-bar" id="annualEventsBar" style="width: 0%; background: var(--success)"></div>
                        </div>
                    </div>
                </div>

                <!-- Team Performance -->
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">üë• Team Performance</h2>
                            <p class="card-subtitle">Click any card for detailed breakdown</p>
                        </div>
                    </div>
                    <div class="rep-cards-grid" id="repCardsGrid">
                        <div class="loading"><div class="spinner"></div> Loading...</div>
                    </div>
                </div>

                <!-- Team Revenue Chart -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üìà Revenue Trend vs Target</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="teamRevenueChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Rep Detail Modal -->
    <div class="modal-overlay" id="repModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalRepName">Rep Details</h2>
                <button class="modal-close" onclick="closeRepModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="loading"><div class="spinner"></div> Loading...</div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ==================== CONFIGURATION ====================
        const CONFIG = {
            baseId: localStorage.getItem('airtableBaseId') || 'app0WnWepz3soa88I',
            apiKey: localStorage.getItem('airtableApiKey') || '',
            passwords: {
                rep: 'nuconnect2025',
                leadership: 'admin2025'
            },
            leadershipUsers: ['Ramallah', 'Keyna'],
            tierTargets: {
                rep: { Starter: 1, Growth: '2-3', Pro: 2, Enterprise: '0-1' },
                team: { Starter: '3-4', Growth: '7-8', Pro: '5-6', Enterprise: '2-3' }
            },
            floorLimits: { Starter: 2, Growth: 2, Pro: 3, Enterprise: 3 }
        };

        let currentUser = null;
        let isLeadership = false;
        let currentView = 'rep';
        let dataCache = { deals: [], activities: [], teamMembers: [] };
        let charts = {};

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('todayDate').textContent = new Date().toLocaleDateString('en-US', {
                weekday: 'long', month: 'long', day: 'numeric', year: 'numeric'
            });
            
            // Check for saved session
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                isLeadership = CONFIG.leadershipUsers.includes(savedUser);
                showApp();
            }
            
            // Load saved credentials
            document.getElementById('baseIdInput').value = CONFIG.baseId;
            document.getElementById('apiKeyInput').value = CONFIG.apiKey;
        });

        // ==================== AUTH ====================
        function handleLogin() {
            const user = document.getElementById('loginUser').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');
            
            if (!user) {
                errorEl.textContent = 'Please select your name';
                errorEl.classList.remove('hidden');
                return;
            }
            
            const isLeaderUser = CONFIG.leadershipUsers.includes(user);
            const correctPassword = isLeaderUser ? CONFIG.passwords.leadership : CONFIG.passwords.rep;
            
            if (password !== correctPassword) {
                errorEl.textContent = 'Incorrect password';
                errorEl.classList.remove('hidden');
                return;
            }
            
            currentUser = user;
            isLeadership = isLeaderUser;
            localStorage.setItem('currentUser', user);
            showApp();
        }

        function handleLogout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            isLeadership = false;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser;
            document.getElementById('userRole').textContent = isLeadership ? 'Leadership' : 'Sales Rep';
            
            // Show/hide leadership toggle
            if (!isLeadership) {
                document.getElementById('viewToggle').style.display = 'none';
            }
            
            loadData();
        }

        // ==================== DATA LOADING ====================
        async function loadData() {
            if (!CONFIG.apiKey) {
                toggleSettings();
                showToast('Please configure your Airtable API key', 'warning');
                return;
            }

            try {
                // Load deals
                const dealsRes = await fetch(`https://api.airtable.com/v0/${CONFIG.baseId}/Deals`, {
                    headers: { 'Authorization': `Bearer ${CONFIG.apiKey}` }
                });
                if (!dealsRes.ok) throw new Error('Failed to load deals');
                const dealsData = await dealsRes.json();
                dataCache.deals = dealsData.records || [];

                // Load activities
                const activitiesRes = await fetch(`https://api.airtable.com/v0/${CONFIG.baseId}/Activities`, {
                    headers: { 'Authorization': `Bearer ${CONFIG.apiKey}` }
                });
                if (activitiesRes.ok) {
                    const activitiesData = await activitiesRes.json();
                    dataCache.activities = activitiesData.records || [];
                }

                // Load team members
                const teamRes = await fetch(`https://api.airtable.com/v0/${CONFIG.baseId}/Team%20Members`, {
                    headers: { 'Authorization': `Bearer ${CONFIG.apiKey}` }
                });
                if (teamRes.ok) {
                    const teamData = await teamRes.json();
                    dataCache.teamMembers = teamData.records || [];
                }

                renderDashboard();
                showToast('Data loaded successfully', 'success');
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Error loading data. Check your API settings.', 'error');
                renderDemoData();
            }
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderDashboard() {
            if (currentView === 'rep' || !isLeadership) {
                renderRepDashboard();
            } else {
                renderLeadershipDashboard();
            }
        }

        function renderRepDashboard() {
            const userDeals = getUserDeals(currentUser);
            const monthDeals = getMonthDeals(userDeals);
            const todayActivities = getTodayActivities(currentUser);

            // Daily Scorecard
            const touchpoints = todayActivities.length;
            const newLeads = todayActivities.filter(a => (a.fields['Activity Type'] || '').includes('Lead')).length;
            const discoveries = todayActivities.filter(a => (a.fields['Activity Type'] || '').includes('Discovery')).length;
            const dealsMoved = todayActivities.filter(a => (a.fields['Activity Type'] || '').includes('Stage')).length;

            updateScorecard('touchpointsCard', 'touchpointsValue', touchpoints, 20, 25);
            updateScorecard('leadsCard', 'leadsValue', newLeads, 3, 5);
            updateScorecard('discoveryCard', 'discoveryValue', discoveries, 1, 1);
            updateScorecard('dealsMovedCard', 'dealsMovedValue', dealsMoved, 1, 1);

            // Monthly KPIs
            const totalRevenue = monthDeals.reduce((sum, d) => sum + (d.fields['Amount'] || 0), 0);
            const dealsCount = monthDeals.length;
            const quality = calculateQuality(monthDeals);
            const avgDeal = dealsCount > 0 ? totalRevenue / dealsCount : 0;

            document.getElementById('repRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('repRevenueBar').style.width = Math.min((totalRevenue / 9750) * 100, 100) + '%';
            document.getElementById('repDeals').textContent = dealsCount;
            document.getElementById('repQuality').textContent = quality + '%';
            document.getElementById('repAvgDeal').textContent = formatCurrency(avgDeal);

            // Quality Badge
            const badgeEl = document.getElementById('qualityBadge');
            const badgeClass = quality >= 70 ? 'success' : quality >= 50 ? 'warning' : 'danger';
            const badgeText = quality >= 70 ? '‚úÖ Quality Goal Met' : '‚ö†Ô∏è Need More Growth+ Deals';
            badgeEl.innerHTML = `<span class="quality-badge ${badgeClass}">${badgeText}</span>`;

            // Deal Mix Table
            renderDealMixTable(monthDeals, userDeals);

            // Recent Wins
            renderRecentWins(monthDeals);

            // Revenue Chart
            renderRevenueChart('repRevenueChart', userDeals);
        }

        function renderLeadershipDashboard() {
            const allDeals = dataCache.deals;
            const wonDeals = allDeals.filter(d => d.fields['Stage'] === 'Closed Won');
            const now = new Date();
            
            const monthDeals = wonDeals.filter(d => {
                const closeDate = d.fields['Close Date'];
                if (!closeDate) return false;
                const date = new Date(closeDate);
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            });

            const yearDeals = wonDeals.filter(d => {
                const closeDate = d.fields['Close Date'];
                if (!closeDate) return false;
                return new Date(closeDate).getFullYear() === now.getFullYear();
            });

            // Monthly Team KPIs
            const monthRevenue = monthDeals.reduce((sum, d) => sum + (d.fields['Amount'] || 0), 0);
            const teamQuality = calculateQuality(monthDeals);
            const todayTouchpoints = dataCache.activities.filter(a => {
                const actDate = a.fields['Activity Date'];
                return actDate && actDate.startsWith(new Date().toISOString().split('T')[0]);
            }).length;

            document.getElementById('teamRevenue').textContent = formatCurrency(monthRevenue);
            document.getElementById('teamRevenueBar').style.width = Math.min((monthRevenue / 32000) * 100, 100) + '%';
            document.getElementById('teamEvents').textContent = monthDeals.length;
            document.getElementById('teamQuality').textContent = teamQuality + '%';
            document.getElementById('teamTouchpoints').textContent = todayTouchpoints;

            // Annual Progress
            const annualRevenue = yearDeals.reduce((sum, d) => sum + (d.fields['Amount'] || 0), 0);
            document.getElementById('annualRevenue').textContent = formatCurrency(annualRevenue);
            document.getElementById('annualRevenueBar').style.width = Math.min((annualRevenue / 335000) * 100, 100) + '%';
            document.getElementById('annualEvents').textContent = yearDeals.length;
            document.getElementById('annualEventsBar').style.width = Math.min((yearDeals.length / 140) * 100, 100) + '%';

            // Floor Pricing Tracker
            renderFloorPricingTracker(yearDeals);

            // Rep Cards
            renderRepCards();

            // Team Revenue Chart
            renderRevenueChart('teamRevenueChart', allDeals, true);
        }

        function renderDealMixTable(monthDeals, allDeals) {
            const tiers = {
                Starter: { target: '1', closed: 0, pipeline: 0, revenue: 0 },
                Growth: { target: '2-3', closed: 0, pipeline: 0, revenue: 0 },
                Pro: { target: '2', closed: 0, pipeline: 0, revenue: 0 },
                Enterprise: { target: '0-1', closed: 0, pipeline: 0, revenue: 0 }
            };

            monthDeals.forEach(d => {
                const tier = d.fields['Tier'] || d.fields['Tier (calculated)'] || 'Growth';
                if (tiers[tier]) {
                    tiers[tier].closed++;
                    tiers[tier].revenue += d.fields['Amount'] || 0;
                }
            });

            allDeals.filter(d => !['Closed Won', 'Closed Lost'].includes(d.fields['Stage'])).forEach(d => {
                const tier = d.fields['Tier'] || d.fields['Tier (calculated)'] || 'Growth';
                if (tiers[tier]) tiers[tier].pipeline++;
            });

            const tbody = document.getElementById('dealMixBody');
            tbody.innerHTML = Object.entries(tiers).map(([tier, data]) => {
                const avgSize = data.closed > 0 ? data.revenue / data.closed : 0;
                return `
                    <tr>
                        <td><span class="tier-badge ${tier.toLowerCase()}">${tier}</span></td>
                        <td>${data.target}</td>
                        <td><strong>${data.closed}</strong></td>
                        <td>${data.pipeline}</td>
                        <td>${formatCurrency(data.revenue)}</td>
                        <td>${formatCurrency(avgSize)}</td>
                    </tr>
                `;
            }).join('');
        }

        function renderRecentWins(deals) {
            const list = document.getElementById('recentWins');
            const recent = deals.slice(-5).reverse();

            if (recent.length === 0) {
                list.innerHTML = '<li class="empty-state"><div class="empty-icon">üéØ</div>No wins yet this month. Keep pushing!</li>';
                return;
            }

            list.innerHTML = recent.map(d => {
                const tier = d.fields['Tier'] || d.fields['Tier (calculated)'] || 'Growth';
                const cycleTime = d.fields['Cycle Time (Days)'] || '-';
                const daysAgo = d.fields['Days Since Closed'] || 0;
                const amount = d.fields['Amount'] || 0;
                const eventName = d.fields['Event Name'] || d.fields['Deal Name'] || 'Event';

                return `
                    <li class="win-item">
                        <div class="win-info">
                            <span class="tier-badge ${tier.toLowerCase()}">${tier}</span>
                            <div class="win-details">
                                <h4>${eventName}</h4>
                                <div class="win-meta">${cycleTime} day cycle ‚Ä¢ ${daysAgo} days ago</div>
                            </div>
                        </div>
                        <div class="win-amount">${formatCurrency(amount)}</div>
                    </li>
                `;
            }).join('');
        }

        function renderFloorPricingTracker(yearDeals) {
            const floorDeals = yearDeals.filter(d => d.fields['Pricing Type'] === 'Floor Price');
            const floorByTier = { Starter: 0, Growth: 0, Pro: 0, Enterprise: 0 };

            floorDeals.forEach(d => {
                const tier = d.fields['Tier'] || d.fields['Tier (calculated)'] || 'Growth';
                if (floorByTier[tier] !== undefined) floorByTier[tier]++;
            });

            const totalUsed = Object.values(floorByTier).reduce((a, b) => a + b, 0);
            const remaining = 10 - totalUsed;
            const percent = Math.round((totalUsed / 10) * 100);

            document.getElementById('floorUsed').textContent = totalUsed;
            document.getElementById('floorPercent').textContent = percent + '% Utilized';
            document.getElementById('floorRemaining').textContent = `Remaining: ${remaining}`;

            const tbody = document.getElementById('floorCapacityBody');
            tbody.innerHTML = Object.entries(CONFIG.floorLimits).map(([tier, max]) => {
                const used = floorByTier[tier];
                const left = max - used;
                const cellClass = left === 0 ? 'zero' : left === 1 ? 'low' : '';
                return `
                    <tr>
                        <td><span class="tier-badge ${tier.toLowerCase()}">${tier}</span></td>
                        <td>${max}</td>
                        <td>${used}</td>
                        <td class="remaining-cell ${cellClass}">${left}</td>
                    </tr>
                `;
            }).join('');
        }

        function renderRepCards() {
            const reps = ['Javonte', 'Teslim', 'Israel', 'Conrad'];
            const grid = document.getElementById('repCardsGrid');

            grid.innerHTML = reps.map(rep => {
                const deals = getUserDeals(rep);
                const monthDeals = getMonthDeals(deals);
                const revenue = monthDeals.reduce((sum, d) => sum + (d.fields['Amount'] || 0), 0);
                const quality = calculateQuality(monthDeals);
                const todayActs = getTodayActivities(rep);
                const initials = rep.split(' ').map(n => n[0]).join('');

                return `
                    <div class="rep-card" onclick="showRepModal('${rep}')">
                        <div class="rep-header">
                            <div class="rep-avatar">${initials}</div>
                            <div>
                                <div class="rep-name">${rep}</div>
                                <div class="rep-role">${rep === 'Conrad' ? 'AE' : 'BDR'}</div>
                            </div>
                        </div>
                        <div class="rep-metrics">
                            <div class="rep-metric">
                                <div class="rep-metric-value">${formatCurrency(revenue, true)}</div>
                                <div class="rep-metric-label">This Month</div>
                            </div>
                            <div class="rep-metric">
                                <div class="rep-metric-value">${monthDeals.length}</div>
                                <div class="rep-metric-label">Deals</div>
                            </div>
                            <div class="rep-metric">
                                <div class="rep-metric-value">${quality}%</div>
                                <div class="rep-metric-label">Quality</div>
                            </div>
                            <div class="rep-metric">
                                <div class="rep-metric-value">${todayActs.length}</div>
                                <div class="rep-metric-label">Today</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderRevenueChart(canvasId, deals, isTeam = false) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            // Destroy existing chart
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            // Get last 6 months of data
            const months = [];
            const revenues = [];
            const targets = [];
            const now = new Date();

            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthName = date.toLocaleDateString('en-US', { month: 'short' });
                months.push(monthName);

                const monthDeals = deals.filter(d => {
                    const closeDate = d.fields['Close Date'];
                    if (!closeDate || d.fields['Stage'] !== 'Closed Won') return false;
                    const dealDate = new Date(closeDate);
                    return dealDate.getMonth() === date.getMonth() && dealDate.getFullYear() === date.getFullYear();
                });

                const revenue = monthDeals.reduce((sum, d) => sum + (d.fields['Amount'] || 0), 0);
                revenues.push(revenue);
                targets.push(isTeam ? 33000 : 11000);
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Revenue',
                            data: revenues,
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3
                        },
                        {
                            label: 'Target',
                            data: targets,
                            borderColor: '#94a3b8',
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => '$' + (value / 1000) + 'K'
                            }
                        }
                    }
                }
            });
        }

        // ==================== HELPER FUNCTIONS ====================
        function getUserDeals(userName) {
            return dataCache.deals.filter(d => {
                const ownerName = d.fields['Name (from Owner)'];
                if (Array.isArray(ownerName)) return ownerName.includes(userName);
                return ownerName === userName || d.fields['Owner'] === userName;
            });
        }

        function getMonthDeals(deals) {
            const now = new Date();
            return deals.filter(d => {
                const closeDate = d.fields['Close Date'];
                if (!closeDate || d.fields['Stage'] !== 'Closed Won') return false;
                const date = new Date(closeDate);
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            });
        }

        function getTodayActivities(userName) {
            const today = new Date().toISOString().split('T')[0];
            return dataCache.activities.filter(a => {
                const actDate = a.fields['Activity Date'];
                const owner = a.fields['Name (from Owner)'] || a.fields['Owner'];
                const isOwner = Array.isArray(owner) ? owner.includes(userName) : owner === userName;
                return isOwner && actDate && actDate.startsWith(today);
            });
        }

        function calculateQuality(deals) {
            if (deals.length === 0) return 0;
            const growthPlus = deals.filter(d => {
                const tier = d.fields['Tier'] || d.fields['Tier (calculated)'];
                return ['Growth', 'Pro', 'Enterprise'].includes(tier);
            }).length;
            return Math.round((growthPlus / deals.length) * 100);
        }

        function updateScorecard(cardId, valueId, value, min, max) {
            document.getElementById(valueId).textContent = value;
            const card = document.getElementById(cardId);
            card.classList.remove('success', 'warning', 'danger');
            if (value >= max) {
                card.classList.add('success');
            } else if (value >= min) {
                card.classList.add('warning');
            } else {
                card.classList.add('danger');
            }
        }

        function formatCurrency(amount, short = false) {
            if (short && amount >= 1000) {
                return '$' + (amount / 1000).toFixed(1) + 'K';
            }
            return '$' + amount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        // ==================== NAVIGATION ====================
        function switchNav(el) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            // In a full app, this would switch views
        }

        function switchView(view, btn) {
            currentView = view;
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if (view === 'rep') {
                document.getElementById('repDashboard').classList.remove('hidden');
                document.getElementById('leadershipDashboard').classList.add('hidden');
                renderRepDashboard();
            } else {
                document.getElementById('repDashboard').classList.add('hidden');
                document.getElementById('leadershipDashboard').classList.remove('hidden');
                renderLeadershipDashboard();
            }
        }

        // ==================== MODAL ====================
        function showRepModal(repName) {
            const modal = document.getElementById('repModal');
            document.getElementById('modalRepName').textContent = repName + ' - Detailed Breakdown';

            const deals = getUserDeals(repName);
            const monthDeals = getMonthDeals(deals);
            const todayActs = getTodayActivities(repName);
            const revenue = monthDeals.reduce((sum, d) => sum + (d.fields['Amount'] || 0), 0);
            const quality = calculateQuality(monthDeals);

            // Activity breakdown
            const activityTypes = {};
            todayActs.forEach(a => {
                const type = a.fields['Activity Type'] || 'Other';
                activityTypes[type] = (activityTypes[type] || 0) + 1;
            });

            // Deal mix
            const dealMix = { Starter: 0, Growth: 0, Pro: 0, Enterprise: 0 };
            monthDeals.forEach(d => {
                const tier = d.fields['Tier'] || d.fields['Tier (calculated)'] || 'Growth';
                if (dealMix[tier] !== undefined) dealMix[tier]++;
            });

            document.getElementById('modalBody').innerHTML = `
                <div class="kpi-grid" style="margin-bottom: 24px;">
                    <div class="kpi-card gradient gradient-purple">
                        <div class="kpi-label">Monthly Revenue</div>
                        <div class="kpi-value">${formatCurrency(revenue)}</div>
                        <div class="kpi-target">Target: $9.75K-$12.7K</div>
                    </div>
                    <div class="kpi-card gradient gradient-pink">
                        <div class="kpi-label">Deals Closed</div>
                        <div class="kpi-value">${monthDeals.length}</div>
                        <div class="kpi-target">Target: 6-7</div>
                    </div>
                    <div class="kpi-card gradient gradient-cyan">
                        <div class="kpi-label">Quality Score</div>
                        <div class="kpi-value">${quality}%</div>
                        <div class="kpi-target">Target: 70%+</div>
                    </div>
                    <div class="kpi-card gradient gradient-amber">
                        <div class="kpi-label">Today's Activity</div>
                        <div class="kpi-value">${todayActs.length}</div>
                        <div class="kpi-target">Target: 20-25</div>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 24px;">
                    <h3 class="card-title" style="margin-bottom: 16px;">Activity Breakdown (Today)</h3>
                    <table class="deal-table">
                        ${Object.entries(activityTypes).map(([type, count]) => `
                            <tr><td>${type}</td><td><strong>${count}</strong></td></tr>
                        `).join('') || '<tr><td colspan="2" style="text-align: center; color: var(--gray-500);">No activities today</td></tr>'}
                    </table>
                </div>

                <div class="card">
                    <h3 class="card-title" style="margin-bottom: 16px;">Deal Mix This Month</h3>
                    <table class="deal-table">
                        ${Object.entries(dealMix).map(([tier, count]) => `
                            <tr>
                                <td><span class="tier-badge ${tier.toLowerCase()}">${tier}</span></td>
                                <td><strong>${count}</strong> deals</td>
                            </tr>
                        `).join('')}
                    </table>
                </div>
            `;

            modal.classList.add('active');
        }

        function closeRepModal() {
            document.getElementById('repModal').classList.remove('active');
        }

        document.getElementById('repModal').addEventListener('click', (e) => {
            if (e.target.id === 'repModal') closeRepModal();
        });

        // ==================== SETTINGS ====================
        function toggleSettings() {
            document.getElementById('settingsPanel').classList.toggle('hidden');
        }

        function saveSettings() {
            const baseId = document.getElementById('baseIdInput').value.trim();
            const apiKey = document.getElementById('apiKeyInput').value.trim();

            if (!baseId || !apiKey) {
                showToast('Please fill in both fields', 'warning');
                return;
            }

            CONFIG.baseId = baseId;
            CONFIG.apiKey = apiKey;
            localStorage.setItem('airtableBaseId', baseId);
            localStorage.setItem('airtableApiKey', apiKey);

            toggleSettings();
            loadData();
        }

        // ==================== TOAST ====================
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}</span> ${message}`;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slide-in 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ==================== DEMO DATA ====================
        function renderDemoData() {
            // Render with demo values if API fails
            document.getElementById('touchpointsValue').textContent = '18';
            document.getElementById('leadsValue').textContent = '4';
            document.getElementById('discoveryValue').textContent = '1';
            document.getElementById('dealsMovedValue').textContent = '2';
            document.getElementById('repRevenue').textContent = '$9,250';
            document.getElementById('repDeals').textContent = '5';
            document.getElementById('repQuality').textContent = '80%';
            document.getElementById('repAvgDeal').textContent = '$1,850';

            document.getElementById('qualityBadge').innerHTML = '<span class="quality-badge success">‚úÖ Quality Goal Met</span>';

            document.getElementById('dealMixBody').innerHTML = `
                <tr><td><span class="tier-badge starter">Starter</span></td><td>1</td><td><strong>1</strong></td><td>2</td><td>$750</td><td>$750</td></tr>
                <tr><td><span class="tier-badge growth">Growth</span></td><td>2-3</td><td><strong>2</strong></td><td>5</td><td>$2,500</td><td>$1,250</td></tr>
                <tr><td><span class="tier-badge pro">Pro</span></td><td>2</td><td><strong>2</strong></td><td>3</td><td>$4,000</td><td>$2,000</td></tr>
                <tr><td><span class="tier-badge enterprise">Enterprise</span></td><td>0-1</td><td><strong>0</strong></td><td>1</td><td>$0</td><td>-</td></tr>
            `;

            document.getElementById('recentWins').innerHTML = `
                <li class="win-item">
                    <div class="win-info">
                        <span class="tier-badge growth">Growth</span>
                        <div class="win-details">
                            <h4>Tech Summit 2026</h4>
                            <div class="win-meta">18 day cycle ‚Ä¢ 2 days ago</div>
                        </div>
                    </div>
                    <div class="win-amount">$1,250</div>
                </li>
                <li class="win-item">
                    <div class="win-info">
                        <span class="tier-badge pro">Pro</span>
                        <div class="win-details">
                            <h4>StartUp Connect</h4>
                            <div class="win-meta">24 day cycle ‚Ä¢ 5 days ago</div>
                        </div>
                    </div>
                    <div class="win-amount">$2,000</div>
                </li>
            `;
        }
    </script>
</body>
</html>
